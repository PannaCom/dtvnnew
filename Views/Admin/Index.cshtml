@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/adminLayout.cshtml";
}
<script>
    //doneEditNews
    function doneEditNews(idPost) {
        var titleNews = $('.titleInput-' + idPost).val();
        var link = $('.link-' + idPost).html();
        var view = $('.view-' + idPost).html();
        var rank = $('.rankInput-' + idPost).val();
        var anh = $('.anh-' + idPost).html();
        var xoasua = $('.xoasua-' + idPost).html();

        var html = '';
        html += '<td>' + idPost + '</td>' +
            '<td class="title-' + idPost + '">' + titleNews + '</td>' +
            '<td class="link-' + idPost + '">' + link + '</td>' +
            '<td class="view-' + idPost + '">' + view + '</td>' +
            '<td class="rank-' + idPost + '">' + rank + '</td>' +
            '<td class="anh-' + idPost + '">' + anh + '</td>' +
            '<td class="xoasua-' + idPost + '"><center><a href="javascript:void(0);" onclick="editNews(' + idPost + ');" ><i class="icon-pencil"></i></a> / <a href="javascript:void(0)" onclick="deleteNews(' + idPost +')" ><i class="glyphicon glyphicon-remove_2"></i></a></center></td>';

        $.ajax({
            type: "GET",
            url: "/Admin/editNews",
            data: { idPost: idPost, titleNews: titleNews, rank: rank },
            success: function () {
                alert('ok');
            }
        })
        
        $('.news-' + idPost).html(html);

    }

    //edit news
    function editNews(idPost) {
        var titleNews = $('.title-' + idPost).html();
        var link = $('.link-' + idPost).html();
        var view = $('.view-' + idPost).html();
        var rank = $('.rank-' + idPost).html();
        var anh = $('.anh-' + idPost).html();
        var xoasua = $('.xoasua-' + idPost).html();
        
        var html = '';
        html += '<td>' + idPost + '</td>' +
            '<td class="title-' + idPost + '"><input class="titleInput-' + idPost + '" type="text" value="' + titleNews + '"/></td>' +
            '<td class="link-' + idPost + '">' + link + '</td>' +
            '<td class="view-' + idPost + '">' + view + '</td>' +
            '<td class="rank-' + idPost + '"><input class="rankInput-' + idPost + '" type="text" value="' + rank + '"/></td>' +
            '<td class="anh-' + idPost + '">' + anh + '</td>' +
            '<td class="xoasua-' + idPost + '"><center><a href="javascript:void(0);" onclick="doneEditNews(' + idPost + ');"><i class="glyphicon-ok_2"></i></a><center></td>';

        $('.news-' + idPost).html(html);
    }

    //insert new images
    function insertNewImages(idPost, titleNews) {
        bootbox.confirm("<strong>Upload hình cho tin " + titleNews + "</strong><label style=\"margin-top: 15px;\"><span>URL: </span><input id=\"txtUrlLink\" type=\"text\"/></label>", "Hủy", "Upload", function (r) {
            if (r) {
                var link = $('#txtUrlLink').val();
                
                $.ajax({
                    type: "GET",
                    url: "/Admin/insertNewImages",
                    data: {idPost:idPost, link: link },
                    success: function () {
                        getListNews();
                        bootbox.hideAll();
                    },
                    error: function () {
                        alert('loi ');
                    }
                })
            }

            if(r) $.pageguide(guide, {
                events: {
                    close: function () {
                        $.pageguide('unload');
                    }
                }
            }).open();
        });
    }

    //delete News
    function deleteNews(idNews) {

        bootbox.confirm("Bạn thực sự muốn xóa tin  chứ?", "Không", "Có", function (r) {

            if (r) {

                bootbox.hideAll();
            }

            //if (r) $.pageguide(guide, {
            //    events: {
            //        close: function () {
            //            $.pageguide('unload');
            //        }
            //    }
            //}).open();
        });

        $.ajax({
            type: "POST",
            url: "/Admin/deleteNews",
            data: {idNews:idNews},
            success: function () {
                alert("Xóa thành công!");
            }
        })
    }

    //function get list tin tuc
    function getListNews(keyword,catid) {
        $.ajax({
            type: "GET",
            url: "/Admin/getListNews",
            data: {keyword:keyword,catid:catid},
            success: function (resp) {
                var jsonData = '{"jsonData":' + resp + '}';
                var json_parse = $.parseJSON(jsonData);
                var html = '';

                for (var i = 0; i < json_parse.jsonData.length; i++) {
                    if (json_parse.jsonData[i]) {
                        n = json_parse.jsonData[i];

                        if (n.hascontent == 0)
                            html += '<tr class="error news-' + n.idnews + '">';
                        else
                            html += '<tr class="news-' + n.idnews + '">';

                        html += '<td>' + n.idnews + '</td>' +
                                '<td class="title-' + n.idnews + '">' + n.titlenews + '</td>' +
                                '<td class="link-' + n.idnews + '">' + n.link + '</td>' +
                                '<td class="view-' + n.idnews + '">' + n.viewcount + '</td>' +
                                '<td class="rank-' + n.idnews + '">' + n.ranking + '</td>';
                        //if (n.images != '') {
                            html += '<td class="anh-' + n.idnews + '"><a onclick="insertNewImages(' + n.idnews + ',\'' + n.titlenews + '\')"><i class="icon-cloud-upload"></i></a><a rel="gallery" class="fancybox" href="' + n.images + '" title="' + n.titlenews + '"><img src="' + n.images + '" style="width: 32px; height: 32px;"/></a></td>';
                        //}
                        //else {
                        //    html += '<td class="anh-' + n.idnews + '"><center><a href="javascript:void(0);" onclick="insertNewImages(' + n.idnews + ',\'' + n.titlenews + '\')"><i class="icon-cloud-upload"></i></a></center></td>'
                        //}
                        html += '<td class="xoasua-' + n.idnews + '"><center><a  onclick="editNews(' + n.idnews + ');" ><i class="icon-pencil"></i></a> / <a  onclick="deleteNews(' + n.idnews + ')" ><i class="glyphicon glyphicon-remove_2"></i></a></center></td>' +
                                '</tr>';
                    }
                }

                $('.listNew').html(html);
            },
            error: function () {
                alert('fail');
            }
        })
    }

    $(document).ready(function () {
        getListNews();

        $("#txtSearch").keypress(function (e) {
            if (e.keyCode == 13) {
                var keyword = $("#txtSearch").val();
                var catid = $("#catid").val();
                //alert(catid);
                getListNews(keyword,catid);
            }
        })

        $('.fancybox').fancybox({
            openEffect: 'none',
            closeEffect: 'none',
            helpers: {
                title: {
                    type: 'float'
                },
            },
        });
    });
</script>
<style type="text/css">
    .dataTables_filter {
        display: block;
        margin: 10px;
        float: right;
    }

</style>
<div class="container-fluid">
    <div class="page-header">
        <div class="pull-left">
		    <h1>Danh Sách Tin Tức</h1>    
		</div>
        <div class="pull-right">
		    <ul class="minitiles">
				<li class='grey'>
					<a href="#"><i class="icon-cogs"></i></a>
				</li>
				<li class='lightgrey'>
					<a href="#"><i class="icon-globe"></i></a>
				</li>
			</ul>
			<ul class="stats">
				<li class='lightred'>
					<i class="icon-calendar green"></i>
						<div class="details">
							<span class="big">February 22, 2013</span>
							<span>Wednesday, 13:56</span>
						</div>
				</li>
			</ul>   
		</div>
    </div>
    <div class="row-fluid">
						<div class="span12">
							<div class="box box-color box-bordered red" style="width:100%; position:relative;">
								<div class="box-title">
									<h3>
										<i class="icon-table"></i>
										Top 100 tin mới nhất
									</h3>
								</div>
                                <div class="dataTables_filter">
                                        <label>
                                            <span>
                                                Tìm Kiếm:
                                            </span>
                                            <input id="txtSearch" type="search" placeholder="Nhập để tìm kiếm..."/>
                                            Chuyên mục:<select id="catid" name="catid">
                                                            <option value="-1">Tất cả</option>
                                                            <option value="1">Xã Hội</option>
                                                            <option value="2">Thế giới</option>
                                                            <option value="3">Kinh tế</option>
                                                            <option value="4">Văn hóa</option>
                                                            <option value="5">Thể thao</option>
                                                            <option value="6">Pháp Luật</option>
                                                            <option value="7">Khoa học</option>
                                                            <option value="8">Công nghệ</option>
                                                            <option value="9">Ô tô xe máy</option>
                                                            <option value="10">Giáo dục</option>
                                                            <option value="12">Sức khỏe</option>
                                                       </select>
                                        </label>
                                    </div>
						    <div class="box-content nopadding">
							<table class="table table-hover table-nomargin table-bordered">
								    <thead>
									    <tr>
										    <th style="width: 5%;" >#ID</th>
										    <th style="width: 20%">Tiêu Đề</th>
										    <th style="width: 50%;">Link</th>
										    <th style="width: 5%;">Lượt Xem</th>
										    <th style="width: 5%;">Rank</th>
										    <th style="width: 10%;">Ảnh</th>
										    <th style="width: 5%;">Sửa/Xóa</th>
									    </tr>
								    </thead>
							    <tbody class="listNew">

						        </tbody>
					</table>
				</div>
			</div>
		</div>
	</div>				
</div>